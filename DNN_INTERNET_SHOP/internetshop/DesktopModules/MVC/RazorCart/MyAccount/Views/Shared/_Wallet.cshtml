@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<RazorCart.MyAccount.Models.AccountModel>
@using DotNetNuke.Web.Mvc.Helpers

<div class="rzc-basket" ng-if="!account.walletForm">
    <div class="table-responsive">
        <table class="table table-striped table-hover table-condensed">
            <thead>
                <tr>
                    <th>@Dnn.LocalizeString("ItemName")</th>
                    <th>@Dnn.LocalizeString("PaymentMethod")</th>
                    <th>@Dnn.LocalizeString("AccountNumber")</th>
                    <th>@Dnn.LocalizeString("BillTo")</th>
                    <th></th>
                </tr>
            </thead>
            <tbody ng-repeat="item in account.walletItems">
                <tr>
                    <td>{{item.WalletName}}</td>
                    <td>{{item.PayType}}</td>
                    <td>{{item.MaskAcctNo}}</td>
                    <td>
                        {{
                            (item.BillingName ? item.BillingName + ', ' : '') +
                            (item.Address1 ? item.Address1 : '') +
                            (item.Address2 ? ' ' + item.Address2 + ', ' : ', ') +
                            (item.City ? item.City + ', ' : '') +
                            (item.State ? item.State + ' ' : '') +
                            (item.Zip ? item.Zip + ', ' : '') +
                            (item.Country ? item.Country : '')
                        }}
                    </td>
                    <td class="text-right">
                        <i class="fa fa-pencil-square-o fa-lg" role="button" ng-click="account.editWallet($index)"></i>
                        <i class="fa fa-trash-o fa-lg" role="button" ng-click="account.deleteWallet($index)"></i>
                    </td>
                </tr>
            </tbody>
            <tbody ng-if="account.walletItems.length < 1">
                <tr>
                    <td colspan="5"><span>@Dnn.LocalizeString("NoWallet")</span></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="row" ng-if="account.walletForm">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="panel-title text-uppercase">@Dnn.LocalizeString("AddWalletItem")</span>
            </div>
            <div class="panel-body">
                <div class="form-horizontal">
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletPayment.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletPayment.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("PaymentMethod")</label>
                        <div class="col-md-7 col-sm-8" ng-init="account.defaultPayment()">
                            <select name="walletPayment" class="form-control" ng-model="account.walletItem.Payment" ng-change="account.defaultPaymentChange(account.walletItem, true)" required>
                                <option ng-value="" disabled selected>-- @Dnn.LocalizeString("PaymentMethod") --</option>
                                <option ng-repeat="payment in account.billingPayments | filter: account.isWalletPayment" value="{{payment.PayMethodID}}">{{payment.Name}}</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletWalletName.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletName.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("WalletName")</label>
                        <div class="col-md-7 col-sm-8">
                            <input type="text" name="walletName" class="form-control" placeholder="@Dnn.LocalizeString("WalletName")" ng-model="account.walletItem.WalletName" required>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletName.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletName.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("WalletNameRequired")
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletFullName.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletFullName.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BillingName")</label>
                        <div class="col-md-7 col-sm-8">
                            <input type="text" name="walletFullName" class="form-control" placeholder="@Dnn.LocalizeString("NameOnBillingAccount")" ng-model="account.walletItem.FullName" required>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletFullName.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletFullName.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BillingNameRequired")
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="account.selectedPayment.DisplayType == 'CreditCard'">
                        <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCardNumber.$dirty || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCVV.$dirty) && (rzcForm_@(Dnn.ModuleContext.ModuleId).walletCardNumber.$invalid || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCVV.$invalid) }">
                            <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("CreditCardNumber")</label>
                            <div class="col-md-5 col-sm-6">
                                <input type="tel" name="walletCardNumber" class="form-control" placeholder="@Dnn.LocalizeString("CardNumber")" ng-model="account.walletItem.CardNumber" autocomplete="off" pattern="^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12}|(?:2131|1800|35\d{3})\d{11}|[x|X]{4}-[x|X]{4}-[x|X]{4}-[0-9]{4})$" required>
                                <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletCardNumber.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCardNumber.$dirty">
                                    <div class="form-control-required" ng-message="required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("CardNumberRequired")
                                    </div>
                                    <div class="form-control-required" ng-message="pattern">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("CardNumberInvalid")
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2 col-sm-2">
                                <input type="tel" name="walletCVV" class="form-control" placeholder="@Dnn.LocalizeString("SecurityCode")" ng-model="account.walletItem.CVV" autocomplete="off" pattern="^([0-9]{3,4})$">
                                <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletCVV.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCVV.$dirty">
                                    <div class="form-control-required" ng-message="required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("SecurityCodeRequired")
                                    </div>
                                    <div class="form-control-required" ng-message="pattern">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("SecurityCodeInvalid")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="account.selectedPayment.DisplayType == 'CreditCard'">
                        <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpMonth.$dirty && rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpYear.$dirty) && (rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpMonth.$invalid || rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpYear.$invalid) }">
                            <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("ExpirationDate")</label>
                            <div class="col-md-4 col-sm-4">
                                <select name="walletExpMonth" class="form-control" ng-model="account.walletItem.ExpMonth" ng-change="" required>
                                    <option value="" disabled selected>-- @Dnn.LocalizeString("ExpirationMonth") --</option>
                                    <option ng-repeat="month in account.expMonths" value="{{month.Value}}">{{month.Text}}</option>
                                </select>
                                <div ng-show="rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpMonth.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpMonth.$dirty">
                                    <div class="form-control-required" ng-show="rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpMonth.$error.required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("ExpirationMonthRequired")
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-4">
                                <select name="walletExpYear" class="form-control" ng-model="account.walletItem.ExpYear" ng-change="" required>
                                    <option value="" disabled selected>-- @Dnn.LocalizeString("ExpirationYear") --</option>
                                    <option ng-repeat="year in account.expYears" value="{{year.Value}}">{{year.Text}}</option>
                                </select>
                                <div ng-show="rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpYear.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpYear.$dirty">
                                    <div class="form-control-required" ng-show="rzcForm_@(Dnn.ModuleContext.ModuleId).walletExpYear.$error.required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("ExpirationYearRequired")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="account.selectedPayment.DisplayType == 'ECheck'">
                        <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletBankName.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletBankName.$invalid }">
                            <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BankName")</label>
                            <div class="col-md-7 col-sm-8">
                                <input type="text" name="walletBankName" class="form-control" placeholder="@Dnn.LocalizeString("BankName")" ng-model="account.walletItem.BankName" required>
                                <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletBankName.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletBankName.$dirty">
                                    <div class="form-control-required" ng-message="required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BankNameRequired")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="account.selectedPayment.DisplayType == 'ECheck'">
                        <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletAccountNumber.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletAccountNumber.$invalid }">
                            <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("AccountNumber")</label>
                            <div class="col-md-7 col-sm-8">
                                <input type="tel" name="walletAccountNumber" class="form-control" placeholder="@Dnn.LocalizeString("AccountNumber")" ng-model="account.walletItem.AccountNumber" autocomplete="off" pattern="^([0-9]{4,17}|[x|X]{8}[0-9]{4})$" required>
                                <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletAccountNumber.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletAccountNumber.$dirty">
                                    <div class="form-control-required" ng-message="required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("AccountNumberRequired")
                                    </div>
                                    <div class="form-control-required" ng-message="pattern">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("AccountNumberInvalid")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div ng-if="account.selectedPayment.DisplayType == 'ECheck'">
                        <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletRoutingNumber.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletRoutingNumber.$invalid }">
                            <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("RoutingNumber")</label>
                            <div class="col-md-7 col-sm-8">
                                <input type="tel" name="walletRoutingNumber" class="form-control" placeholder="@Dnn.LocalizeString("RoutingNumber")" ng-model="account.walletItem.RoutingNumber" autocomplete="off" pattern="^([0-9]{9})$" required>
                                <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletRoutingNumber.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletRoutingNumber.$dirty">
                                    <div class="form-control-required" ng-message="required">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("RoutingNumberRequired")
                                    </div>
                                    <div class="form-control-required" ng-message="pattern">
                                        <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("RoutingNumberInvalid")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletAddress1.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletAddress1.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BillingAddress")</label>
                        <div class="col-md-7 col-sm-8">
                            <input type="text" name="walletAddress1" class="form-control" placeholder="@Dnn.LocalizeString("Address1")" ng-model="account.walletItem.Address1" required>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletAddress1.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletAddress1.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BillingAddress1Required")
                                </div>
                            </div>
                            <input type="text" name="walletAddress2" class="form-control" placeholder="@Dnn.LocalizeString("Address2")" ng-model="account.walletItem.Address2">
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCity.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletCity.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BillingCity")</label>
                        <div class="col-md-7 col-sm-8">
                            <input type="text" name="walletCity" class="form-control" placeholder="@Dnn.LocalizeString("City")" ng-model="account.walletItem.City" required>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletCity.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCity.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BillingCityRequired")
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletPostalCode.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletPostalCode.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BillingPostalCode")</label>
                        <div class="col-md-7 col-sm-8">
                            <input type="text" name="walletPostalCode" class="form-control" placeholder="@Dnn.LocalizeString("PostalCode")" ng-model="account.walletItem.PostalCode" required>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletPostalCode.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletPostalCode.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BillingPostalCodeRequired")
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCountry.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletCountry.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BillingCountry")</label>
                        <div class="col-md-7 col-sm-8">
                            <select name="walletCountry" class="form-control" ng-model="account.walletItem.CountryID" ng-change="account.updateRegionList(account.walletItem, true)" required>
                                <option value="" disabled selected>-- @Dnn.LocalizeString("Country") --</option>
                                <option ng-repeat="country in account.countries" value="{{country.EntryID}}">{{country.Text}}</option>
                            </select>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletCountry.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletCountry.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BillingCountryRequired")
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" ng-class="{ 'has-error has-feedback': (account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletRegion.$dirty) && rzcForm_@(Dnn.ModuleContext.ModuleId).walletRegion.$invalid }">
                        <label class="col-md-3 col-sm-4 control-label">@Dnn.LocalizeString("BillingRegion")</label>
                        <div class="col-md-7 col-sm-8">
                            <select name="walletRegion" class="form-control" ng-model="account.walletItem.RegionID" required>
                                <option value="" disabled selected>-- @Dnn.LocalizeString("StateRegion") --</option>
                                <option ng-repeat="region in account.walletItem.RegionList" value="{{region.EntryID}}">{{region.Text}}</option>
                            </select>
                            <div ng-messages="rzcForm_@(Dnn.ModuleContext.ModuleId).walletRegion.$error" ng-if="account.submitted || rzcForm_@(Dnn.ModuleContext.ModuleId).walletRegion.$dirty">
                                <div class="form-control-required" ng-message="required">
                                    <i class="fa fa-exclamation-circle fa-lg"></i> @Dnn.LocalizeString("BillingRegionRequired")
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group">
        <div class="col-xs-12 text-center">
            <input type="button" class="btn btn-primary" value="@Dnn.LocalizeString("AddWalletItem")" ng-click="account.submitted = false; account.walletItem = {}; account.walletForm = true" ng-if="!account.walletForm" />
            <input type="button" class="btn btn-default" value="@Dnn.LocalizeString("Cancel")" ng-click="account.walletForm = false" ng-if="account.walletForm" />
            <input type="button" class="btn btn-primary" value="@Dnn.LocalizeString("Save")" ng-click="account.submitted = true; rzcForm_@(Dnn.ModuleContext.ModuleId).$valid && account.saveWallet()" ng-if="account.walletForm" ng-disabled="account.submitting" />
        </div>
    </div>
</div>